#!/bin/bash
if [[ $EUID -ne 0 ]]; then
    doas "$0" "$@"
    exit $?
fi

if [[ $1 == "sync" ]]; then
    emerge --sync --ask=n
fi

emerge --update --newuse --deep --ask --tree --complete-graph --verbose \
    --with-bdeps=y @world && \
    smart-live-rebuild --jobs=6 && \
    emerge --depclean -v --ask
